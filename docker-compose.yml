version: '3.4'

services:
  webapp-production:
    build:
      context: .
      target: prod
    ports: ['8080:8080']
    depends_on: [mongo]
  webapp-test:
    build:
      context: .
      target: test
    volumes: ['./src:/app/src']
    depends_on: [mongo]
  mongo:
    image: mongo:4.2.3
    volumes: ['mongo-db:/data/db', 'mongo-configdb:/data/configdb']
    ports: ['27017:27017']

volumes:
  mongo-db:
  mongo-configdb:
